name: ğŸš€ Manual Deploy to fernandocueto.com

on:
  workflow_dispatch:
    inputs:
      server_dir:
        description: "FTP destination directory"
        required: false
        default: "/projects.fernandocueto.com/2ca/admin/"
      note:
        description: "Optional note for this deploy"
        required: false
        default: "manual run"

jobs:
  deploy:
    runs-on: ubuntu-latest
    name: ğŸš€ Deploy to fernandocueto.com

    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ“¦ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'

      - name: ğŸ“‹ Install dependencies
        run: npm ci

      - name: ğŸ—ï¸ Build for production
        run: npm run build
        env:
          VITE_BASE_API_URL: ${{ secrets.FC_VITE_BASE_API_URL }}
          VITE_BASE_URL: ${{ secrets.FC_VITE_BASE_URL }}
          VITE_AWS_URL: ${{ secrets.FC_VITE_AWS_URL }}

      - name: ğŸ“¦ Create deployment package
        run: |
          cd dist
          zip -r ../deployment.zip .
          cd ..
          ls -la deployment.zip

      - name: ğŸš€ Deploy via FTP
        uses: SamKirkland/FTP-Deploy-Action@v4.3.5
        with:
          server: ${{ secrets.FC_FTP_HOST }}
          username: ${{ secrets.FC_FTP_USERNAME }}
          password: ${{ secrets.FC_FTP_PASSWORD }}
          local-dir: ./dist/
          server-dir: ${{ inputs.server_dir }}
          exclude: |
            **/.git*
            **/.git*/**
            **/node_modules/**
            .env

      - name: âœ… Deployment Success
        run: |
          echo "ğŸ‰ Deployment completed successfully!"
          echo "ğŸ“ Note: ${{ inputs.note }}"
          echo "ğŸŒ The App should be live at: https://projects.fernandocueto.com/2ca/admin"
          echo "ğŸ• Deployed at: $(date)"
          echo "ğŸ§¾ Commit: ${{ github.sha }}"
